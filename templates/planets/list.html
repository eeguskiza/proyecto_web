{% extends 'index.html' %}
{% load static %}
{% block title %}Star Wars - Planetas{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/planets.css' %}">
{% endblock %}

{% block content %}

<h2>Planetas</h2>

<section class="planet-filters">
    <form method="get" class="filters-form">
        <label>
            <span>Nombre</span>
            <input type="text" name="q" placeholder="Buscar por nombre" value="{{ filters.q }}">
        </label>
        <label>
            <span>Clima</span>
            <select name="climate">
                <option value="">Cualquier clima</option>
                {% for option in climate_options %}
                    <option value="{{ option }}" {% if filters.climate == option %}selected{% endif %}>{{ option }}</option>
                {% endfor %}
            </select>
        </label>
        <label>
            <span>Terreno</span>
            <select name="terrain">
                <option value="">Cualquier terreno</option>
                {% for option in terrain_options %}
                    <option value="{{ option }}" {% if filters.terrain == option %}selected{% endif %}>{{ option }}</option>
                {% endfor %}
            </select>
        </label>
        <label>
            <span>Sistema estelar</span>
            <select name="system">
                <option value="">Todos los sistemas</option>
                {% for system in system_options %}
                    <option value="{{ system.id }}" {% if filters.system == system.id|stringformat:"s" %}selected{% endif %}>{{ system.name }}</option>
                {% endfor %}
            </select>
        </label>
        <div class="filters-actions">
            <button type="submit">Aplicar filtros</button>
            {% if filters_active %}
                <a href="{% url 'planets' %}" class="reset-link">Limpiar</a>
            {% endif %}
        </div>
    </form>
    {% if filters_active %}
        <p class="filters-result">{{ planets|length }} planetas coinciden con los filtros.</p>
    {% endif %}
</section>

{% if planets %}
<section class="planet-section">
    <div class="planet-container">
        {% for planet in planets %}
            <div class="planet-card">
                <h4>{{ planet.name }}</h4>
                <p><strong>Clima:</strong> {{ planet.display_climate }}</p>
                <p><strong>Terreno:</strong> {{ planet.display_terrain }}</p>
                <p><strong>Población:</strong> {{ planet.display_population }}</p>
                <p><strong>Sistema estelar:</strong> {{ planet.display_system }}</p>
                <p><strong>Capital:</strong> {{ planet.display_capital }}</p>
                <p><strong>Coordenadas:</strong> {{ planet.display_grid }}</p>
            </div>
        {% endfor %}
    </div>
</section>
{% else %}
<p>No hay planetas disponibles en este momento.</p>
{% endif %}

<section class="planet-inquiry">
    <h3>Envía una transmisión al Senado</h3>
    <p>Comparte información adicional sobre un planeta o reporta anomalías.</p>
    {% if form_success %}
        <div class="form-success">Transmisión recibida. Gracias por colaborar con la galaxia.</div>
    {% endif %}
    <form method="post" class="inquiry-form">
        {% csrf_token %}
        <div class="form-grid">
            <div class="form-field {% if inquiry_form.name.errors %}has-error{% endif %}">
                <label for="{{ inquiry_form.name.id_for_label }}">Nombre*</label>
                {{ inquiry_form.name }}
                {% if inquiry_form.name.errors %}
                    <small class="error">{{ inquiry_form.name.errors|striptags }}</small>
                {% endif %}
            </div>
            <div class="form-field {% if inquiry_form.email.errors %}has-error{% endif %}">
                <label for="{{ inquiry_form.email.id_for_label }}">Email</label>
                {{ inquiry_form.email }}
                {% if inquiry_form.email.errors %}
                    <small class="error">{{ inquiry_form.email.errors|striptags }}</small>
                {% endif %}
            </div>
            <div class="form-field {% if inquiry_form.affiliation.errors %}has-error{% endif %}">
                <label for="{{ inquiry_form.affiliation.id_for_label }}">Afiliación</label>
                {{ inquiry_form.affiliation }}
                {% if inquiry_form.affiliation.errors %}
                    <small class="error">{{ inquiry_form.affiliation.errors|striptags }}</small>
                {% endif %}
            </div>
            <div class="form-field {% if inquiry_form.planet.errors %}has-error{% endif %}">
                <label for="{{ inquiry_form.planet.id_for_label }}">Planeta</label>
                {{ inquiry_form.planet }}
                {% if inquiry_form.planet.errors %}
                    <small class="error">{{ inquiry_form.planet.errors|striptags }}</small>
                {% endif %}
            </div>
        </div>
        <div class="form-field {% if inquiry_form.message.errors %}has-error{% endif %}">
            <label for="{{ inquiry_form.message.id_for_label }}">Mensaje*</label>
            {{ inquiry_form.message }}
            {% if inquiry_form.message.errors %}
                <small class="error">{{ inquiry_form.message.errors|striptags }}</small>
            {% endif %}
        </div>
        <button type="submit">Enviar transmisión</button>
    </form>
</section>
{% endblock %}
